name: Build obsidian plugin

on:
    push:
        tags:
            - '*'

# ğŸ”‘ ê¶Œí•œ ì„¤ì • - "Resource not accessible by integration" ì˜¤ë¥˜ í•´ê²°
permissions:
    contents: write

env:
    PLUGIN_NAME: easy-gate  # manifest.jsonì˜ idì™€ ì¼ì¹˜ì‹œí‚´

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4

            - name: Use bun
              uses: oven-sh/setup-bun@v2

            - name: Build
              run: |
                  bun install
                  bun run build

            - name: Prepare release files
              run: |
                  mkdir ${{ env.PLUGIN_NAME }}
                  cp main.js manifest.json styles.css ${{ env.PLUGIN_NAME }}
                  zip -r ${{ env.PLUGIN_NAME }}.zip ${{ env.PLUGIN_NAME }}
                  ls -la

            # ìµœì‹  ë¦´ë¦¬ì¦ˆ ì•¡ì…˜ ì‚¬ìš© (deprecated ì•¡ì…˜ ëŒ€ì²´)
            - name: Create Release
              uses: softprops/action-gh-release@v2
              with:
                  files: |
                      main.js
                      manifest.json
                      styles.css
                      ${{ env.PLUGIN_NAME }}.zip
                  draft: false
                  prerelease: false
                  generate_release_notes: true
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
